{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>ResPax Test Tool</title>

    <link rel="stylesheet" href={% static "css/bootstrap.min.css" %}>
    <link rel="stylesheet" href={% static "css/bootstrap-table-expandable.css" %}>

    <script src={% static "js/jquery-2.1.4.min.js" %}></script>
    <script src={% static "js/collapsibleTable.js" %}></script>

</head>
<body>
<!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">ResPax</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="/testTool/">Home</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">Dropdown <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">Action</a></li>
                        <li><a href="#">Another action</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li role="separator" class="divider"></li>
                        <li class="dropdown-header">Nav header</li>
                        <li><a href="#">Separated link</a></li>
                        <li><a href="#">One more separated link</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/logout/">Log out <span class="sr-only">(current)</span></a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class="container">
    <h1 style="margin-top:150px;">ResPax Test Tool</h1>
    <table id="test-tool-table" class="table table-hover table-expandable table-striped">
        <thead>
        <tr>
            <th colspan="3">Operator</th>
            <th colspan="3">Location</th>
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</div>
</body>
</html>

<script type="text/javascript">
    //var host_name = [];
    //var location = [];
    function generateTable(operators, locations, host_id, code, basis, subbasis, time, pickup_id) {

        for (var i = 0; i in operators; i++) {
            var tableRow = document.createElement('tr');
            var table = document.getElementById("test-tool-table").getElementsByTagName('tbody')[0];
            var operator_td = document.createElement("td");
            var location_td = document.createElement("td");

            var operator_td_value = document.createTextNode(operators[i] + ' (' + host_id[i] + ')');
            var location_td_value = document.createTextNode(locations[i]);

            operator_td.appendChild(operator_td_value);
            location_td.appendChild(location_td_value);

            operator_td.setAttribute("colspan", "3");
            location_td.setAttribute("colspan", "3");

            tableRow.setAttribute("id", (host_id[i]).toString());
            tableRow.setAttribute("onclick", "getTours(this, this.id)");
            tableRow.setAttribute("data-level", "1");

            tableRow.appendChild(operator_td);
            tableRow.appendChild(location_td);

            table.appendChild(tableRow);
        }

    }

    var host_name = {{ host_name|safe }};
    var locations = '';
    var host_id = {{ host_id|safe }};
    var code = '';
    var basis = {{ basis|safe }};
    var subbasis = {{ subbasis|safe }};
    var time = {{ time|safe }};
    var pickup_id = {{ pickup_id|safe }};


    generateTable(host_name, locations, host_id, code, basis, subbasis, time, pickup_id);

    function getTours(tableRow, id) {

        $.ajax({
            type: 'POST',
            url: '/get_tours/',
            dataType: 'json',
            async: true,

            data: {
                id: id,
                safe: false,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },

            success: function (json) {
                console.log(json.tours);
                console.log(json.tour_bases[0]);

                for (var i = 0; i in json.tours; i++) {
                    for (var j = 0; j in json.tour_bases[i]; j++) {
                        var newTableRow = document.createElement('tr');

                        var tour_code_td = document.createElement('td');
                        var basis_td = document.createElement("td");
                        var subbasis_td = document.createElement("td");
                        var time_td = document.createElement("td");
                        var pickup_id_td = document.createElement("td");

                        var tour_code_td_value = document.createTextNode(json.tours[i]['strTourCode']);
                        var basis_td_value = document.createTextNode("Basis: " + json.tour_bases[i][j]['strBasisDesc']);
                        var subbasis_td_value = document.createTextNode("Subbasis: " + json.tour_bases[i][j]['strSubBasisDesc']);
                        var time_td_value = document.createTextNode("Time: " + json.pickup_time[i]['strTourCode']);
                        var pickup_id_td_value = document.createTextNode("Pickup ID: " + json.pickup_id[i]['strTourCode']);

                        tour_code_td.appendChild(tour_code_td_value);
                        basis_td.appendChild(basis_td_value);
                        subbasis_td.appendChild(subbasis_td_value);
                        time_td.appendChild(time_td_value);
                        pickup_id_td.appendChild(pickup_id_td_value);

                        newTableRow.setAttribute("data-level", "2");
                        newTableRow.setAttribute("type", "checkbox");

                        newTableRow.appendChild(tour_code_td);
                        newTableRow.appendChild(basis_td);
                        newTableRow.appendChild(subbasis_td);
                        newTableRow.appendChild(time_td);
                        newTableRow.appendChild(pickup_id_td);

                        $(tableRow).after(newTableRow);


                    }

                    $(tableRow).removeAttr("onclick")


                }

            }
        })


    }

</script>